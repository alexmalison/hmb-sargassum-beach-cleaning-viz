(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&e(o)}).observe(document,{childList:!0,subtree:!0});function a(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function e(i){if(i.ep)return;i.ep=!0;const s=a(i);fetch(i.href,s)}})();const Ee=52/12,Le=1,Se=["#64ffda","#90caf9","#ffd54f","#ff8a80","#ce93d8","#80cbc4"],me={seasonLengthMonths:5,sargassumVolumeM3:7183.15,workDaysPerWeek:6,workHoursPerDay:5,trailerCapacityM3:2,timePerWorkerLoadM3Minutes:25,atvSpeedKmh:3,beachLengthM:600,loadTransferTimeMinutes:11,loadingMode:"single"},Ie={minutesPerSecond:Le,atvOverrideCount:0},Fe=[{key:"seasonLengthMonths",label:"Length of season (months)",min:1,max:12,step:.1,section:"season"},{key:"sargassumVolumeM3",label:"Estimated Sargassum volume (m³)",min:0,max:2e4,step:10,section:"season"},{key:"workDaysPerWeek",label:"Working days per week",min:1,max:7,step:1,section:"season"},{key:"workHoursPerDay",label:"Working hours per day",min:1,max:24,step:.5,section:"season"},{key:"trailerCapacityM3",label:"Trailer capacity (m³)",min:.1,max:5,step:.1,section:"labor"},{key:"timePerWorkerLoadM3Minutes",label:"Time to load 1 m³ per worker (minutes)",min:1,max:60,step:1,section:"labor"},{key:"atvSpeedKmh",label:"ATV speed (km/h)",min:0,max:15,step:.1,section:"atv"},{key:"beachLengthM",label:"Beach length (m)",min:60,max:1500,step:10,section:"atv"},{key:"loadTransferTimeMinutes",label:"Load transfer wait (minutes)",min:0,max:60,step:1,section:"atv"},{key:"loadingMode",label:"Loading mode",type:"select",options:[{value:"single",label:"Whole crew from west"},{value:"split",label:"Split crews west/east"}],section:"labor"}],He=[{key:"avgDailyRemoval",label:"Average daily removal (m³)",format:t=>k(t,{maximumFractionDigits:2})},{key:"avgHourlyRemoval",label:"Average hourly removal (m³)",format:t=>k(t,{maximumFractionDigits:2})},{key:"trailersPerDay",label:"Trailer loads per day",format:t=>k(t,{maximumFractionDigits:2})},{key:"timeWorkerLoadHours",label:"Worker hours to load trailers (per day)",format:t=>k(t,{maximumFractionDigits:2})},{key:"requiredBeachWorkers",label:"Beach workers required (load crew)",format:t=>k(t,{maximumFractionDigits:2})},{key:"timeToLoadTrailerMinutes",label:"Time to load trailer (minutes)",format:t=>k(t,{maximumFractionDigits:2})},{key:"timeToLoadingAreaMinutes",label:"Travel to loading area (minutes)",format:t=>k(t,{maximumFractionDigits:2})},{key:"totalAtvTimePerLoadMinutes",label:"ATV cycle time per load (minutes)",format:t=>k(t,{maximumFractionDigits:2})},{key:"timePerAtvHours",label:"ATV duty time (hours/day)",format:t=>k(t,{maximumFractionDigits:2})},{key:"requiredAtvs",label:"Required # of ATVs",format:t=>k(t,{maximumFractionDigits:2})},{key:"requiredAtvDrivers",label:"Required # of ATV drivers",format:t=>k(t,{maximumFractionDigits:2})},{key:"requiredUnloadWorkers",label:"Required # of unload workers",format:t=>k(t,{maximumFractionDigits:2})},{key:"integerLoads",label:"Loads simulated today",format:t=>k(t,{maximumFractionDigits:0})},{key:"integerAtvs",label:"ATVs in rotation",format:t=>k(t,{maximumFractionDigits:0})},{key:"totalMinutes",label:"Day cycle duration (minutes)",format:t=>k(t,{maximumFractionDigits:1}),note:"Full rotation for busiest ATV within the day"}];function k(t,m={}){return Number.isFinite(t)?new Intl.NumberFormat("en-US",{maximumFractionDigits:2,minimumFractionDigits:0,...m}).format(t):"—"}function qe(t){const m=t.seasonLengthMonths*Ee,a=m*t.workDaysPerWeek,e=a>0?t.sargassumVolumeM3/a:0,i=t.workHoursPerDay>0?e/t.workHoursPerDay:0,s=t.trailerCapacityM3>0?e/t.trailerCapacityM3:0,c=t.timePerWorkerLoadM3Minutes*e/60,v=t.workHoursPerDay>0?c/t.workHoursPerDay:0,P=v>0?t.trailerCapacityM3*t.timePerWorkerLoadM3Minutes/v:0,w=t.atvSpeedKmh*1e3/60,x=t.beachLengthM/2,S=w>0?x/w:0,C=S,L=S+P+C,M=L*s/60,T=t.workHoursPerDay>0?M/t.workHoursPerDay:0,D=T,I=t.workHoursPerDay>0?s*P/60/t.workHoursPerDay:0,h=Math.max(1,Math.round(s)),f=Math.max(1,Math.ceil(T));return{workingWeeks:m,workingDaysSeason:a,avgDailyRemoval:e,avgHourlyRemoval:i,trailersPerDay:s,timeWorkerLoadHours:c,requiredBeachWorkers:v,timeToLoadTrailerMinutes:P,timeToLoadingAreaMinutes:S,totalAtvTimePerLoadMinutes:L,timePerAtvHours:M,requiredAtvs:T,requiredAtvDrivers:D,requiredUnloadWorkers:I,integerLoads:h,integerAtvs:f}}function Ne(t,m,a={}){const e=m.integerLoads,i=Number(a.overrideAtvCount),s=Number.isFinite(i)&&i>0?Math.max(1,Math.round(i)):null,o=s??m.integerAtvs,c=[],v=[],P=Array.from({length:o},()=>[]),w=Array.from({length:o},()=>0),x=Math.max(0,t.loadTransferTimeMinutes??0);if(e<=0||o<=0)return{loadMarkers:c,segmentsByAtv:P,totalMinutes:0,numLoads:0,numAtvs:o,loadStates:v};const S=t.beachLengthM/e,C=m.timeToLoadTrailerMinutes,L=t.atvSpeedKmh>0?t.atvSpeedKmh*1e3/60:0;let M=0,T=0;const D=Array.from({length:e},(h,f)=>{const W=f*S,H=(f+1)*S,N=W+S/2;return{loadIndex:f+1,startPosM:W,endPosM:H,centerPosM:N}});c.push(...D.map(h=>h.centerPosM).sort((h,f)=>h-f));let I;if((t.loadingMode??"single")==="split"){I=[];let h=0,f=e-1,W=!0;for(;h<=f;)W?(I.push({...D[h],crew:"West crew"}),h+=1):(I.push({...D[f],crew:"East crew"}),f-=1),W=!W;I.length&&e%2===1&&(I[I.length-1].crew="Both crews")}else I=D.map(h=>({...h,crew:"Main crew"}));return I.forEach(h=>{const f=h.centerPosM,W=h.startPosM,H=h.endPosM,N=Math.min(f,5),ie=L>0?f/L:0,z=L>0?Math.max(f-N,0)/L:0,se=L>0?N/L:0;let O=0,ne=w[0];for(let B=1;B<o;B+=1)w[B]<ne-Number.EPSILON&&(ne=w[B],O=B);const G=w[O],J=G+ie,K=J+C,X=K+z,oe=X+se;let j=0,$=oe;$<M&&(j=M-$,$=M);const Q=$+x,U=B=>{P[O].push(B),T=Math.max(T,B.endMin)};U({atvId:O,loadId:h.loadIndex,phase:"outbound",startMin:G,endMin:J,startPosM:0,endPosM:f}),U({atvId:O,loadId:h.loadIndex,phase:"loading",startMin:J,endMin:K,startPosM:f,endPosM:f}),z>0?U({atvId:O,loadId:h.loadIndex,phase:"return",startMin:K,endMin:X,startPosM:f,endPosM:N}):U({atvId:O,loadId:h.loadIndex,phase:"return",startMin:K,endMin:K,startPosM:f,endPosM:N}),j>0&&U({atvId:O,loadId:h.loadIndex,phase:"hold",startMin:X,endMin:X+j,startPosM:N,endPosM:N}),U({atvId:O,loadId:h.loadIndex,phase:"approach",startMin:X+j,endMin:$,startPosM:N,endPosM:0}),U({atvId:O,loadId:h.loadIndex,phase:"transfer",startMin:$,endMin:Q,startPosM:0,endPosM:0}),w[O]=Q,M=Q,v.push({startPosM:W,endPosM:H,arrivalMin:J,cleanedAtMinute:K,crew:h.crew,loadId:h.loadIndex})}),{loadMarkers:c,segmentsByAtv:P.map(h=>h.sort((f,W)=>f.startMin-W.startMin)),totalMinutes:T,numLoads:e,numAtvs:o,loadStates:v,overrideAtvCount:s}}function Oe(){const t=document.querySelector("#app");return t.innerHTML=`
    <section class="controls">
      <div class="control-header">
        <h1>HMB Beach Cleanup Model</h1>
        <p>Set the season-scale inputs from the spreadsheet; the animation shows how one workday plays out with those assumptions.</p>
      </div>
      <div class="controls-groups">
        <div class="control-group">
          <h2>Season Parameters</h2>
          <div class="input-grid" data-section="season"></div>
        </div>
        <div class="control-group">
          <h2>Trailer &amp; Labor</h2>
          <div class="input-grid" data-section="labor"></div>
        </div>
        <div class="control-group">
          <h2>ATV Operations</h2>
          <div class="input-grid" data-section="atv"></div>
          <div class="field override-field">
            <label for="atvOverrideInput">Override # of ATVs</label>
            <input
              type="number"
              id="atvOverrideInput"
              min="0"
              step="1"
              placeholder="0 for auto"
            />
            <span class="field-note" id="atvOverrideHint"></span>
          </div>
        </div>
      </div>
      <div class="derived-section" id="derivedSection">
        <div class="derived-header">
          <h2>Derived Metrics</h2>
          <button type="button" class="toggle-derived" id="toggleDerived">Hide metrics</button>
        </div>
        <ul class="metrics-list" id="derivedMetrics"></ul>
      </div>
      <div class="status" id="status"></div>
    </section>
    <section class="simulation">
      <div class="canvas-container">
        <canvas id="beachCanvas" width="960" height="520"></canvas>
        <div class="canvas-overlay canvas-overlay-top">
          <div class="sim-controls">
            <button type="button" id="toggleRun" class="toggle-run">Pause</button>
            <span id="timeLabel" class="sim-stat">Sim time 00:00:00</span>
            <div class="speed-slider">
              <input type="range" id="speedSlider" min="1" max="60" step="1" />
              <span id="speedValue">1 s → 1 min</span>
            </div>
          </div>
        </div>
        <div class="canvas-overlay canvas-overlay-bottom">
          <span id="detailsLabel"></span>
        </div>
      </div>
    </section>
  `,{canvas:document.querySelector("#beachCanvas"),derivedList:document.querySelector("#derivedMetrics"),status:document.querySelector("#status"),timeLabel:document.querySelector("#timeLabel"),toggleButton:document.querySelector("#toggleRun"),detailsLabel:document.querySelector("#detailsLabel"),derivedSection:document.querySelector("#derivedSection"),derivedToggle:document.querySelector("#toggleDerived"),speedSlider:document.querySelector("#speedSlider"),speedValue:document.querySelector("#speedValue"),atvOverrideInput:document.querySelector("#atvOverrideInput"),atvOverrideHint:document.querySelector("#atvOverrideHint")}}function Re(t,m){Fe.forEach(a=>{const e=document.querySelector(`[data-section="${a.section}"]`);if(!e)return;const i=document.createElement("div");i.className="field";const s=document.createElement("label");s.textContent=a.label;let o;if(a.type==="select"&&Array.isArray(a.options))o=document.createElement("select"),a.options.forEach(c=>{const v=document.createElement("option");v.value=String(c.value),v.textContent=c.label,o.append(v)}),o.value=String(t[a.key]),o.addEventListener("change",()=>{const c=o.value,v=Number(c),w=a.options.every(x=>typeof x.value=="number")&&Number.isFinite(v)?v:c;m(a.key,w)});else{o=document.createElement("input");const c=a.type==="text"?"text":"number";if(o.type=c,a.key==="trailerCapacityM3"?o.value=Number(t[a.key]??0).toFixed(1):o.value=String(t[a.key]??""),a.placeholder&&(o.placeholder=a.placeholder),c==="number"){a.min!==void 0&&(o.min=String(a.min)),a.max!==void 0&&(o.max=String(a.max)),a.step!==void 0&&(o.step=String(a.step));const v=()=>{const P=Number(o.value);Number.isFinite(P)&&(m(a.key,P),a.key==="trailerCapacityM3"&&(o.value=P.toFixed(1)))};a.key==="trailerCapacityM3"?(o.addEventListener("change",v),o.addEventListener("blur",v)):o.addEventListener("input",v)}else o.addEventListener("input",()=>{m(a.key,o.value)})}i.append(s,o),e.append(i)})}function We(t,m){const a=document.querySelector("#speedSlider"),e=document.querySelector("#speedValue");if(!a||!e)return;const i=s=>{const o=Math.max(1,Math.round(s));e.textContent=`1 s → ${o} min`,m(s)};a.value=String(t.minutesPerSecond),i(t.minutesPerSecond),a.addEventListener("input",()=>{const s=Number(a.value);!Number.isFinite(s)||s<=0||(t.minutesPerSecond=s,i(s))})}function Ve(t,m,a={}){const e=a.input??document.querySelector("#atvOverrideInput");if(!e)return;const i=s=>{const o=Number(s);!Number.isFinite(o)||o<=0?(t.atvOverrideCount=0,e.value="0"):(t.atvOverrideCount=Math.round(o),e.value=String(t.atvOverrideCount)),m()};e.value=t.atvOverrideCount>0?String(t.atvOverrideCount):"0",e.addEventListener("change",()=>{i(e.value)}),e.addEventListener("blur",()=>{i(e.value)}),e.addEventListener("keydown",s=>{s.key==="Enter"&&(s.preventDefault(),i(e.value))})}function Be(t,m,a){t.innerHTML="",He.forEach(e=>{let i;e.key==="totalMinutes"?i=a.totalMinutes:e.key==="integerAtvs"?i=a.integerAtvs??m.integerAtvs:i=m[e.key];const s=document.createElement("li");s.className="metric-card";const o=document.createElement("span");o.className="label",o.textContent=e.label;const c=document.createElement("span");if(c.className="value",c.textContent=e.format?e.format(i):String(i),s.append(o,c),e.key==="integerAtvs"&&a.overrideAtvs){const v=document.createElement("span");v.className="note";const P=k(a.computedIntegerAtvs,{maximumFractionDigits:0});v.textContent=`Manual override active (computed ${P})`,s.append(v)}else if(e.note){const v=document.createElement("span");v.className="note",v.textContent=e.note,s.append(v)}t.append(s)})}function $e(t,m,a){const e=t.getContext("2d"),i=t.width,s=t.height,o=70;let c={loadMarkers:[],loadStates:[],segmentsByAtv:[],totalMinutes:1,numAtvs:0,beachLength:me.beachLengthM},v={...me},P=Le,w=[],x=!1,S=!1,C=0,L=null,M=null,T=[];const D=new Set;let I="Loaded 0.0 m³",h="Crew idle time 00:00:00";const f=s*.3,W=s*.4,H=f+W;function N(){const n={paused:G(),manuallyPaused:x,autoPaused:S};D.forEach(r=>{try{r(n)}catch{}})}function ie(){M!==null&&(cancelAnimationFrame(M),M=null)}function z(){M===null&&!G()&&(M=requestAnimationFrame(ve))}function se(n,r){c={...n,beachLength:r.beachLengthM},v={...r},w=new Array(c.numAtvs).fill(1),C=0,L=null,S=!1,T=K(c.loadStates??[]),j(C),$(C),Q(C),N(),z()}function O(n){P=n,L=null}function ne(n){const r=x;return typeof n=="boolean"?x=n:x=!x,x?r||ie():(S&&(S=!1,C=0),L=null,z()),N(),x}function G(){return x||S}function J(n){return typeof n!="function"?()=>{}:(D.add(n),n({paused:G(),manuallyPaused:x,autoPaused:S}),()=>{D.delete(n)})}function K(n){const r=n.map(l=>{const g=Math.min(l.arrivalMin,l.cleanedAtMinute),u=Math.max(l.arrivalMin,l.cleanedAtMinute);return u>g?{start:g,end:u}:null}).filter(Boolean).sort((l,g)=>l.start-g.start);if(!r.length)return[];const p=[r[0]];for(let l=1;l<r.length;l+=1){const g=r[l],u=p[p.length-1];g.start<=u.end?u.end=Math.max(u.end,g.end):p.push({...g})}return p}function X(n){if(!T.length||n<=T[0].start)return 0;let r=0;for(let p=0;p<T.length;p+=1){const{start:l,end:g}=T[p];if(n<=l)break;const u=Math.min(g,n);if(r+=Math.max(0,u-l),n<=g)break}return Math.min(r,Math.max(0,n))}function oe(n){const r=Math.max(0,Math.floor(n*60)),p=Math.floor(r/3600),l=Math.floor(r%3600/60),g=r%60;return`${String(p).padStart(2,"0")}:${String(l).padStart(2,"0")}:${String(g).padStart(2,"0")}`}function j(n){m&&(m.textContent=`Sim time ${oe(n)}`)}function $(n){const r=Number(v.trailerCapacityM3)||0;if(r<=0||!Array.isArray(c.loadStates)){I="Loaded 0.0 m³";return}let p=0;c.loadStates.forEach(g=>{const u=g.arrivalMin,d=g.cleanedAtMinute;if(!(!Number.isFinite(u)||!Number.isFinite(d)||d<=u)){if(n>=d)p+=r;else if(n>u){const E=Math.max(0,Math.min((n-u)/(d-u),1));p+=r*E}}}),I=`Loaded ${k(p,{minimumFractionDigits:1,maximumFractionDigits:1})} m³`}function Q(n){const r=X(n),p=Math.max(0,n-r);h=`Crew idle time ${oe(p)}`}function U(){e.fillStyle="#0f2034",e.fillRect(0,0,i,s);const n=e.createLinearGradient(0,0,0,f);n.addColorStop(0,"rgba(183, 244, 255, 0.96)"),n.addColorStop(.35,"rgba(133, 226, 255, 0.94)"),n.addColorStop(.7,"rgba(82, 204, 255, 0.97)"),n.addColorStop(1,"rgba(36, 152, 233, 0.99)"),e.fillStyle=n,e.fillRect(0,0,i,f);const r=e.createLinearGradient(0,f,0,H);r.addColorStop(0,"rgba(214, 196, 148, 0.78)"),r.addColorStop(1,"rgba(191, 166, 115, 0.82)"),e.fillStyle=r,e.fillRect(o,f,i-o*2,H-f),e.strokeStyle="rgba(255, 255, 255, 0.25)",e.lineWidth=2,e.beginPath(),e.moveTo(o,H),e.lineTo(i-o,H),e.stroke(),e.save(),e.textAlign="center",e.fillStyle="rgba(255, 255, 255, 0.7)",e.font='16px "Inter", sans-serif';const p=Math.min(s-12,H+28),g=[`Beach length = ${k(v.beachLengthM,{maximumFractionDigits:0})} m`,I,h];e.fillText(g.join("   •   "),i/2,p),e.restore()}function B(n){const r=i-o*2,l=(H-f)*.25,g=H-l;c.loadStates.forEach(u=>{const d=o+u.startPosM/c.beachLength*r,E=o+u.endPosM/c.beachLength*r,F=u.arrivalMin,y=u.cleanedAtMinute;if(y<=0)return;const V=e.createLinearGradient(d,g,E,H);if(V.addColorStop(0,"rgba(194, 178, 128, 0.65)"),V.addColorStop(1,"rgba(214, 198, 148, 0.7)"),e.save(),e.fillStyle=V,e.fillRect(d,g,E-d,l),e.restore(),n>=y)return;let q=1;if(n>F){const A=Math.max(y-F,.01),R=Math.min(Math.max((n-F)/A,0),1);q=Math.max(0,1-R)}if(q<=0)return;e.save(),e.globalAlpha=q;const b=e.createLinearGradient(d,g,E,H);b.addColorStop(0,"rgba(121, 85, 72, 0.92)"),b.addColorStop(.5,"rgba(93, 64, 55, 0.95)"),b.addColorStop(1,"rgba(121, 85, 72, 0.92)"),e.fillStyle=b,e.fillRect(d,g,E-d,l),e.restore()})}function Te(n,r,p=1){if(!n.length)return{position:0,phase:"idle",loadId:null,direction:p,progress:0};const l=n[n.length-1].endMin;if(l===0)return{position:0,phase:"idle",loadId:null,direction:p,progress:0};let g=r%l,u=p;for(let F=0;F<n.length;F+=1){const y=n[F];if(g<y.startMin)return{position:y.startPosM,phase:"idle",loadId:y.loadId,direction:u,progress:0};if(g<=y.endMin||y.endMin===y.startMin){const V=y.endMin-y.startMin,q=V>0?(g-y.startMin)/V:1,b=y.startPosM+(y.endPosM-y.startPosM)*q,A=Math.sign(y.endPosM-y.startPosM);return A!==0&&(u=A),{position:b,phase:y.phase,loadId:y.loadId,direction:u,progress:q}}}const d=n[n.length-1],E=Math.sign(d.endPosM-d.startPosM);return E!==0&&(u=E),{position:d.endPosM,phase:"idle",loadId:d.loadId,direction:u,progress:0}}function Ae(){e.strokeStyle="rgba(255, 255, 255, 0.12)",e.lineWidth=1,e.setLineDash([6,8]),c.loadMarkers.forEach(n=>{const r=o+n/c.beachLength*(i-o*2);e.beginPath(),e.moveTo(r,f),e.lineTo(r,H),e.stroke()}),e.setLineDash([])}function ke(n,r,p,l=1,g=!1){e.save();const u=5,d=28,E=12,F=36,y=14,V=8,q=l>=0?1:-1,b=n-d/2,A=r-u-E,R=b+d,le=r-u-y+2;let _,Y,te,de;if(q>=0?(Y=b-V,_=Y-F,te=b,de=Y):(_=R+V,Y=_+F,te=R,de=_),e.fillStyle=p,e.fillRect(b,A,d,E),e.fillStyle="rgba(255, 255, 255, 0.2)",e.fillRect(b+6,A+3,12,E-6),e.fillStyle=p,e.fillRect(_,le,F,y),g){const ee=y*.9,ye=F*.08,ue=_+ye,be=Y-ye,re=le+2,De=re-ee;e.fillStyle="#8d6e63",e.beginPath(),e.moveTo(ue,re),e.quadraticCurveTo((ue+be)/2,De,be,re),e.lineTo(ue,re),e.closePath(),e.fill()}e.strokeStyle="rgba(255, 255, 255, 0.4)",e.lineWidth=2,e.beginPath(),e.moveTo(te,r-u-2),e.lineTo(de,r-u+1),e.stroke();const he="rgba(15, 32, 52, 0.85)",xe=[{x:b+d*.25,y:r},{x:R-d*.25,y:r},{x:_+F*.2,y:r+1},{x:Y-F*.2,y:r+1}];e.fillStyle=he,xe.forEach(ee=>{e.beginPath(),e.arc(ee.x,ee.y,u,0,Math.PI*2),e.fill(),e.fillStyle="rgba(255, 255, 255, 0.25)",e.beginPath(),e.arc(ee.x,ee.y,u*.4,0,Math.PI*2),e.fill(),e.fillStyle=he}),e.fillStyle="rgba(15, 32, 52, 0.85)";const fe=12,Ce=q>=0?R-fe+2:b-2;e.fillRect(Ce,A-6,fe,6),e.beginPath(),q>=0?(e.moveTo(R-d*.7,A),e.lineTo(R-d*.4,A-8),e.lineTo(R-d*.15,A-8),e.lineTo(R-d*.3,A)):(e.moveTo(b+d*.7,A),e.lineTo(b+d*.4,A-8),e.lineTo(b+d*.15,A-8),e.lineTo(b+d*.3,A)),e.closePath(),e.fill();const Z=q>=0?R-d*.35:b+d*.35,ce=4,pe=A-ce-2,we=8,ge=6;e.fillStyle="#ffd180",e.beginPath(),e.arc(Z,pe,ce,0,Math.PI*2),e.fill(),e.fillStyle="#0f2034",e.fillRect(Z-ge/2,pe+ce-1,ge,we);const ae=A+2,Me=10;e.strokeStyle="#cfd8dc",e.lineWidth=2,e.beginPath(),q>=0?(e.moveTo(Z-2,ae),e.lineTo(Z-2-Me,ae-2)):(e.moveTo(Z+2,ae),e.lineTo(Z+2+Me,ae-2)),e.stroke(),e.restore()}function Pe(n){const r=[];c.segmentsByAtv.forEach((p,l)=>{const g=w[l]??1,{position:u,phase:d,loadId:E,direction:F,progress:y}=Te(p,n,g);w[l]=F||g||1;const V=Se[l%Se.length],q=o+u/c.beachLength*(i-o*2),b=H-30-l*18,A=.001,R=d==="loading"&&y>=1-A||d==="return"||d==="hold"||d==="approach"||d==="transfer"&&y<1-A;ke(q,b,V,w[l],R),e.fillStyle=V,e.font='12px "Inter", sans-serif',e.fillText(`ATV ${l+1}`,q-20,b+22);const _=(E?c.loadStates.find(te=>te.loadId===E):void 0)?.crew??"Crew",Y=k(v.trailerCapacityM3,{minimumFractionDigits:1,maximumFractionDigits:1});r.push(`ATV ${l+1}: ${d} load ${E??"—"} (${_}, capacity ${Y} m³)`)}),a.textContent=r.join("  •  ")}function ve(n){if(G()){M=null;return}L===null&&(L=n);const r=Math.max((n-L)/1e3,0);L=n;const p=Math.max(c.totalMinutes,1);C+=r*P,C>p&&(C=p);const l=C;if(U(),B(l),Ae(),Pe(l),j(l),$(l),Q(l),C>=p){S=!0,M=null,N();return}M=requestAnimationFrame(ve)}return z(),{update:se,updateSpeed:O,toggleManualPause:ne,isPaused:G,onStateChange:J}}function Ue(t,m,a){if(m.atvSpeedKmh<=0){t.textContent="Increase ATV speed above zero to animate the transport cycle.";return}if(a.trailersPerDay<=0||a.requiredAtvs<=0){t.textContent="Adjust inputs to produce a non-zero workload for ATVs.";return}t.textContent=""}function _e(){const t={...me},m={...Ie},{canvas:a,derivedList:e,status:i,timeLabel:s,toggleButton:o,detailsLabel:c,derivedSection:v,derivedToggle:P,atvOverrideInput:w,atvOverrideHint:x}=Oe(),S=$e(a,s,c);let C=!1;function L(){const M=qe(t),T=m.atvOverrideCount>0?m.atvOverrideCount:null,D=Ne(t,M,{overrideAtvCount:T}),I={totalMinutes:D.totalMinutes,integerAtvs:D.numAtvs,overrideAtvs:D.overrideAtvCount!=null,computedIntegerAtvs:M.integerAtvs};if(Be(e,M,I),Ue(i,t,M),S.update(D,t),x){const h=k(M.integerAtvs,{maximumFractionDigits:0});if(D.overrideAtvCount!=null){const f=k(D.overrideAtvCount,{maximumFractionDigits:0});x.textContent=`Manual override active (${f} ATVs, computed ${h}).`}else x.textContent=`Using computed requirement (${h} ATVs).`}}if(Re(t,(M,T)=>{t[M]=T,L()}),We(m,M=>{S.updateSpeed(M)}),o){const M=({paused:T})=>{o.textContent=T?"Run":"Pause"};S.onStateChange(M),o.addEventListener("click",()=>{const T=S.isPaused();S.toggleManualPause(!T)})}Ve(m,L,{input:w}),P.addEventListener("click",()=>{C=!C,v.classList.toggle("collapsed",C),P.textContent=C?"Show metrics":"Hide metrics"}),L()}_e();
