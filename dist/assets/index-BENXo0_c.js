(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))l(r);new MutationObserver(r=>{for(const e of r)if(e.type==="childList")for(const a of e.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&l(a)}).observe(document,{childList:!0,subtree:!0});function o(r){const e={};return r.integrity&&(e.integrity=r.integrity),r.referrerPolicy&&(e.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?e.credentials="include":r.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function l(r){if(r.ep)return;r.ep=!0;const e=o(r);fetch(r.href,e)}})();const Ee=52/12,Le=1,Se=["#64ffda","#90caf9","#ffd54f","#ff8a80","#ce93d8","#80cbc4"],me={seasonLengthMonths:5,sargassumVolumeM3:7183.15,workDaysPerWeek:6,workHoursPerDay:5,trailerCapacityM3:2,timePerWorkerLoadM3Minutes:25,atvSpeedKmh:3,beachLengthM:600,loadTransferTimeMinutes:11,loadingMode:"single"},De={minutesPerSecond:Le,atvOverrideEnabled:!1,atvOverrideCount:null},Ie=[{key:"seasonLengthMonths",label:"Length of season (months)",min:1,max:12,step:.1,section:"season"},{key:"sargassumVolumeM3",label:"Estimated Sargassum volume (m³)",min:0,max:2e4,step:10,section:"season"},{key:"workDaysPerWeek",label:"Working days per week",min:1,max:7,step:1,section:"season"},{key:"workHoursPerDay",label:"Working hours per day",min:1,max:24,step:.5,section:"season"},{key:"trailerCapacityM3",label:"Trailer capacity (m³)",min:.1,max:5,step:.1,section:"labor"},{key:"timePerWorkerLoadM3Minutes",label:"Time to load 1 m³ per worker (minutes)",min:1,max:60,step:1,section:"labor"},{key:"atvSpeedKmh",label:"ATV speed (km/h)",min:0,max:15,step:.1,section:"atv"},{key:"beachLengthM",label:"Beach length (m)",min:60,max:1500,step:10,section:"atv"},{key:"loadTransferTimeMinutes",label:"Load transfer wait (minutes)",min:0,max:60,step:1,section:"atv"},{key:"loadingMode",label:"Loading mode",type:"select",options:[{value:"single",label:"Whole crew from west"},{value:"split",label:"Split crews west/east"}],section:"labor"}],Oe=[{key:"avgDailyRemoval",label:"Average daily removal (m³)",format:t=>T(t,{maximumFractionDigits:2})},{key:"avgHourlyRemoval",label:"Average hourly removal (m³)",format:t=>T(t,{maximumFractionDigits:2})},{key:"trailersPerDay",label:"Trailer loads per day",format:t=>T(t,{maximumFractionDigits:2})},{key:"timeWorkerLoadHours",label:"Worker hours to load trailers (per day)",format:t=>T(t,{maximumFractionDigits:2})},{key:"requiredBeachWorkers",label:"Beach workers required (load crew)",format:t=>T(t,{maximumFractionDigits:2})},{key:"timeToLoadTrailerMinutes",label:"Time to load trailer (minutes)",format:t=>T(t,{maximumFractionDigits:2})},{key:"timeToLoadingAreaMinutes",label:"Travel to loading area (minutes)",format:t=>T(t,{maximumFractionDigits:2})},{key:"totalAtvTimePerLoadMinutes",label:"ATV cycle time per load (minutes)",format:t=>T(t,{maximumFractionDigits:2})},{key:"timePerAtvHours",label:"ATV duty time (hours/day)",format:t=>T(t,{maximumFractionDigits:2})},{key:"requiredAtvs",label:"Required # of ATVs",format:t=>T(t,{maximumFractionDigits:2})},{key:"requiredAtvDrivers",label:"Required # of ATV drivers",format:t=>T(t,{maximumFractionDigits:2})},{key:"requiredUnloadWorkers",label:"Required # of unload workers",format:t=>T(t,{maximumFractionDigits:2})},{key:"integerLoads",label:"Loads simulated today",format:t=>T(t,{maximumFractionDigits:0})},{key:"integerAtvs",label:"ATVs in rotation",format:t=>T(t,{maximumFractionDigits:0})},{key:"totalMinutes",label:"Day cycle duration (minutes)",format:t=>T(t,{maximumFractionDigits:1}),note:"Full rotation for busiest ATV within the day"}];function T(t,m={}){return Number.isFinite(t)?new Intl.NumberFormat("en-US",{maximumFractionDigits:2,minimumFractionDigits:0,...m}).format(t):"—"}function Fe(t){const m=t.seasonLengthMonths*Ee,o=m*t.workDaysPerWeek,l=o>0?t.sargassumVolumeM3/o:0,r=t.workHoursPerDay>0?l/t.workHoursPerDay:0,e=t.trailerCapacityM3>0?l/t.trailerCapacityM3:0,d=t.timePerWorkerLoadM3Minutes*l/60,s=t.workHoursPerDay>0?d/t.workHoursPerDay:0,g=s>0?t.trailerCapacityM3*t.timePerWorkerLoadM3Minutes/s:0,w=t.atvSpeedKmh*1e3/60,R=t.beachLengthM/2,D=w>0?R/w:0,E=D,A=D+g+E,S=A*e/60,k=t.workHoursPerDay>0?S/t.workHoursPerDay:0,P=k,M=t.workHoursPerDay>0?e*g/60/t.workHoursPerDay:0,c=Math.max(1,Math.round(e)),h=Math.max(1,Math.ceil(k));return{workingWeeks:m,workingDaysSeason:o,avgDailyRemoval:l,avgHourlyRemoval:r,trailersPerDay:e,timeWorkerLoadHours:d,requiredBeachWorkers:s,timeToLoadTrailerMinutes:g,timeToLoadingAreaMinutes:D,totalAtvTimePerLoadMinutes:A,timePerAtvHours:S,requiredAtvs:k,requiredAtvDrivers:P,requiredUnloadWorkers:M,integerLoads:c,integerAtvs:h}}function qe(t,m,o={}){const l=m.integerLoads,r=Number(o.overrideAtvCount),e=Number.isFinite(r)&&r>0?Math.max(1,Math.round(r)):null,a=e??m.integerAtvs,d=[],s=[],g=Array.from({length:a},()=>[]),w=Array.from({length:a},()=>0),R=Math.max(0,t.loadTransferTimeMinutes??0);if(l<=0||a<=0)return{loadMarkers:d,segmentsByAtv:g,totalMinutes:0,numLoads:0,numAtvs:a,loadStates:s};const D=t.beachLengthM/l,E=m.timeToLoadTrailerMinutes,A=t.atvSpeedKmh>0?t.atvSpeedKmh*1e3/60:0;let S=0,k=0;const P=Array.from({length:l},(c,h)=>{const L=h*D,N=(h+1)*D,q=L+D/2;return{loadIndex:h+1,startPosM:L,endPosM:N,centerPosM:q}});d.push(...P.map(c=>c.centerPosM).sort((c,h)=>c-h));let M;if((t.loadingMode??"single")==="split"){M=[];let c=0,h=l-1,L=!0;for(;c<=h;)L?(M.push({...P[c],crew:"West crew"}),c+=1):(M.push({...P[h],crew:"East crew"}),h-=1),L=!L;M.length&&l%2===1&&(M[M.length-1].crew="Both crews")}else M=P.map(c=>({...c,crew:"Main crew"}));return M.forEach(c=>{const h=c.centerPosM,L=c.startPosM,N=c.endPosM,q=Math.min(h,5),Z=A>0?h/A:0,ne=A>0?Math.max(h-q,0)/A:0,se=A>0?q/A:0;let H=0,K=w[0];for(let B=1;B<a;B+=1)w[B]<K-Number.EPSILON&&(K=w[B],H=B);const oe=w[H],z=oe+Z,Y=z+E,X=Y+ne,ae=X+se;let j=0,$=ae;$<S&&(j=S-$,$=S);const ee=$+R,U=B=>{g[H].push(B),k=Math.max(k,B.endMin)};U({atvId:H,loadId:c.loadIndex,phase:"outbound",startMin:oe,endMin:z,startPosM:0,endPosM:h}),U({atvId:H,loadId:c.loadIndex,phase:"loading",startMin:z,endMin:Y,startPosM:h,endPosM:h}),ne>0?U({atvId:H,loadId:c.loadIndex,phase:"return",startMin:Y,endMin:X,startPosM:h,endPosM:q}):U({atvId:H,loadId:c.loadIndex,phase:"return",startMin:Y,endMin:Y,startPosM:h,endPosM:q}),j>0&&U({atvId:H,loadId:c.loadIndex,phase:"hold",startMin:X,endMin:X+j,startPosM:q,endPosM:q}),U({atvId:H,loadId:c.loadIndex,phase:"approach",startMin:X+j,endMin:$,startPosM:q,endPosM:0}),U({atvId:H,loadId:c.loadIndex,phase:"transfer",startMin:$,endMin:ee,startPosM:0,endPosM:0}),w[H]=ee,S=ee,s.push({startPosM:L,endPosM:N,arrivalMin:z,cleanedAtMinute:Y,crew:c.crew,loadId:c.loadIndex})}),{loadMarkers:d,segmentsByAtv:g.map(c=>c.sort((h,L)=>h.startMin-L.startMin)),totalMinutes:k,numLoads:l,numAtvs:a,loadStates:s,overrideAtvCount:e}}function He(){const t=document.querySelector("#app");return t.innerHTML=`
    <section class="controls">
      <div class="control-header">
        <h1>HMB Beach Cleanup Model</h1>
        <p>Set the season-scale inputs from the spreadsheet; the animation shows how one workday plays out with those assumptions.</p>
      </div>
      <div class="controls-groups">
        <div class="control-group">
          <h2>Season Parameters</h2>
          <div class="input-grid" data-section="season"></div>
        </div>
        <div class="control-group">
          <h2>Trailer &amp; Labor</h2>
          <div class="input-grid" data-section="labor"></div>
        </div>
        <div class="control-group">
          <h2>ATV Operations</h2>
          <div class="input-grid" data-section="atv"></div>
          <div class="field override-field">
            <label for="atvOverrideToggle">Override # of ATVs</label>
            <div class="override-controls">
              <select id="atvOverrideToggle">
                <option value="no">No</option>
                <option value="yes">Yes</option>
              </select>
              <input
                type="number"
                id="atvOverrideInput"
                min="1"
                step="1"
                placeholder="Manual count"
              />
            </div>
            <span class="field-note" id="atvOverrideHint"></span>
          </div>
        </div>
      </div>
      <div class="derived-section" id="derivedSection">
        <div class="derived-header">
          <h2>Derived Metrics</h2>
          <button type="button" class="toggle-derived" id="toggleDerived">Hide metrics</button>
        </div>
        <ul class="metrics-list" id="derivedMetrics"></ul>
      </div>
      <div class="status" id="status"></div>
    </section>
    <section class="simulation">
      <div class="canvas-container">
        <canvas id="beachCanvas" width="960" height="520"></canvas>
        <div class="canvas-overlay canvas-overlay-top">
          <div class="sim-controls">
            <div class="sim-primary">
              <span id="timeLabel" class="sim-time">Sim time 00:00</span>
              <button type="button" id="toggleRun" class="toggle-run">Pause</button>
            </div>
            <span id="loadedLabel" class="sim-loaded">Loaded 0.0 m³</span>
            <span id="idleLabel" class="sim-idle">Crew idle time 00:00:00</span>
          </div>
          <div class="speed-slider">
            <input type="range" id="speedSlider" min="1" max="60" step="1" />
            <span id="speedValue"></span>
          </div>
        </div>
        <div class="canvas-overlay canvas-overlay-bottom">
          <span id="detailsLabel"></span>
        </div>
      </div>
    </section>
  `,{canvas:document.querySelector("#beachCanvas"),derivedList:document.querySelector("#derivedMetrics"),status:document.querySelector("#status"),timeLabel:document.querySelector("#timeLabel"),loadedLabel:document.querySelector("#loadedLabel"),idleLabel:document.querySelector("#idleLabel"),toggleButton:document.querySelector("#toggleRun"),detailsLabel:document.querySelector("#detailsLabel"),derivedSection:document.querySelector("#derivedSection"),derivedToggle:document.querySelector("#toggleDerived"),speedSlider:document.querySelector("#speedSlider"),speedValue:document.querySelector("#speedValue"),atvOverrideToggle:document.querySelector("#atvOverrideToggle"),atvOverrideInput:document.querySelector("#atvOverrideInput"),atvOverrideHint:document.querySelector("#atvOverrideHint")}}function Ne(t,m){Ie.forEach(o=>{const l=document.querySelector(`[data-section="${o.section}"]`);if(!l)return;const r=document.createElement("div");r.className="field";const e=document.createElement("label");e.textContent=o.label;let a;if(o.type==="select"&&Array.isArray(o.options))a=document.createElement("select"),o.options.forEach(d=>{const s=document.createElement("option");s.value=String(d.value),s.textContent=d.label,a.append(s)}),a.value=String(t[o.key]),a.addEventListener("change",()=>{const d=a.value,s=Number(d),w=o.options.every(R=>typeof R.value=="number")&&Number.isFinite(s)?s:d;m(o.key,w)});else{a=document.createElement("input");const d=o.type==="text"?"text":"number";if(a.type=d,o.key==="trailerCapacityM3"?a.value=Number(t[o.key]??0).toFixed(1):a.value=String(t[o.key]??""),o.placeholder&&(a.placeholder=o.placeholder),d==="number"){o.min!==void 0&&(a.min=String(o.min)),o.max!==void 0&&(a.max=String(o.max)),o.step!==void 0&&(a.step=String(o.step));const s=()=>{const g=Number(a.value);Number.isFinite(g)&&(m(o.key,g),o.key==="trailerCapacityM3"&&(a.value=g.toFixed(1)))};o.key==="trailerCapacityM3"?(a.addEventListener("change",s),a.addEventListener("blur",s)):a.addEventListener("input",s)}else a.addEventListener("input",()=>{m(o.key,a.value)})}r.append(e,a),l.append(r)})}function Re(t,m){const o=document.querySelector("#speedSlider"),l=document.querySelector("#speedValue");if(!o||!l)return;const r=e=>{const a=Math.max(1,Math.round(e));l.textContent=`1 s → ${a} min`,m(e)};o.value=String(t.minutesPerSecond),r(t.minutesPerSecond),o.addEventListener("input",()=>{const e=Number(o.value);!Number.isFinite(e)||e<=0||(t.minutesPerSecond=e,r(e))})}function We(t,m,o={}){const l=o.toggle??document.querySelector("#atvOverrideToggle"),r=o.input??document.querySelector("#atvOverrideInput");if(!l||!r)return;const e=d=>{r.disabled=!d,d||(t.atvOverrideCount=null,r.value="")};l.value=t.atvOverrideEnabled?"yes":"no",t.atvOverrideCount!=null&&(r.value=String(t.atvOverrideCount)),e(t.atvOverrideEnabled),l.addEventListener("change",()=>{const d=l.value==="yes";if(t.atvOverrideEnabled=d,d&&!r.value){const s=Number(l.dataset.computedAtvs);Number.isFinite(s)&&s>0&&(t.atvOverrideCount=Math.max(1,Math.round(s)),r.value=String(t.atvOverrideCount))}e(d),m()});const a=()=>{if(!t.atvOverrideEnabled)return;const d=Number(r.value);if(!Number.isFinite(d)||d<=0){t.atvOverrideCount=null,r.value="",m();return}t.atvOverrideCount=Math.round(d),r.value=String(t.atvOverrideCount),m()};r.addEventListener("blur",a),r.addEventListener("keydown",d=>{d.key==="Enter"&&a()})}function Ve(t,m,o){t.innerHTML="",Oe.forEach(l=>{let r;l.key==="totalMinutes"?r=o.totalMinutes:l.key==="integerAtvs"?r=o.integerAtvs??m.integerAtvs:r=m[l.key];const e=document.createElement("li");e.className="metric-card";const a=document.createElement("span");a.className="label",a.textContent=l.label;const d=document.createElement("span");if(d.className="value",d.textContent=l.format?l.format(r):String(r),e.append(a,d),l.key==="integerAtvs"&&o.overrideAtvs){const s=document.createElement("span");s.className="note";const g=T(o.computedIntegerAtvs,{maximumFractionDigits:0});s.textContent=`Manual override active (computed ${g})`,e.append(s)}else if(l.note){const s=document.createElement("span");s.className="note",s.textContent=l.note,e.append(s)}t.append(e)})}function Be(t,m,o,l,r){const e=t.getContext("2d"),a=t.width,d=t.height,s=70;let g={loadMarkers:[],loadStates:[],segmentsByAtv:[],totalMinutes:1,numAtvs:0,beachLength:me.beachLengthM},w={...me},R=Le,D=[],E=!1,A=!1,S=0,k=null,P=null,M=[];const c=new Set,h=d*.3,L=d*.7;function N(){const n={paused:K(),manuallyPaused:E,autoPaused:A};c.forEach(i=>{try{i(n)}catch{}})}function q(){P!==null&&(cancelAnimationFrame(P),P=null)}function Z(){P===null&&!K()&&(P=requestAnimationFrame(ve))}function ne(n,i){g={...n,beachLength:i.beachLengthM},w={...i},D=new Array(g.numAtvs).fill(1),S=0,k=null,A=!1,M=z(g.loadStates??[]),ae(S),j(S),$(S),N(),Z()}function se(n){R=n,k=null}function H(n){const i=E;return typeof n=="boolean"?E=n:E=!E,E?i||q():(A&&(A=!1,S=0),k=null,Z()),N(),E}function K(){return E||A}function oe(n){return typeof n!="function"?()=>{}:(c.add(n),n({paused:K(),manuallyPaused:E,autoPaused:A}),()=>{c.delete(n)})}function z(n){const i=n.map(u=>{const y=Math.min(u.arrivalMin,u.cleanedAtMinute),f=Math.max(u.arrivalMin,u.cleanedAtMinute);return f>y?{start:y,end:f}:null}).filter(Boolean).sort((u,y)=>u.start-y.start);if(!i.length)return[];const p=[i[0]];for(let u=1;u<i.length;u+=1){const y=i[u],f=p[p.length-1];y.start<=f.end?f.end=Math.max(f.end,y.end):p.push({...y})}return p}function Y(n){if(!M.length||n<=M[0].start)return 0;let i=0;for(let p=0;p<M.length;p+=1){const{start:u,end:y}=M[p];if(n<=u)break;const f=Math.min(y,n);if(i+=Math.max(0,f-u),n<=y)break}return Math.min(i,Math.max(0,n))}function X(n){const i=Math.max(0,Math.floor(n*60)),p=Math.floor(i/3600),u=Math.floor(i%3600/60),y=i%60;return`${String(p).padStart(2,"0")}:${String(u).padStart(2,"0")}:${String(y).padStart(2,"0")}`}function ae(n){m&&(m.textContent=`Sim time ${X(n)}`)}function j(n){if(!o)return;const i=Number(w.trailerCapacityM3)||0;if(i<=0||!Array.isArray(g.loadStates)){o.textContent="Loaded 0.0 m³";return}let p=0;g.loadStates.forEach(y=>{const f=y.arrivalMin,v=y.cleanedAtMinute;if(!(!Number.isFinite(f)||!Number.isFinite(v)||v<=f)){if(n>=v)p+=i;else if(n>f){const F=Math.max(0,Math.min((n-f)/(v-f),1));p+=i*F}}});const u=T(p,{minimumFractionDigits:1,maximumFractionDigits:1});o.textContent=`Loaded ${u} m³`}function $(n){if(!l)return;const i=Y(n),p=Math.max(0,n-i);l.textContent=`Crew idle time ${X(p)}`}function ee(){e.fillStyle="#0f2034",e.fillRect(0,0,a,d);const n=e.createLinearGradient(0,h,0,L);n.addColorStop(0,"rgba(230, 254, 255, 0.08)"),n.addColorStop(.5,"rgba(110, 192, 230, 0.18)"),n.addColorStop(1,"rgba(255, 255, 255, 0.05)"),e.fillStyle=n,e.fillRect(s,h,a-s*2,L-h),e.strokeStyle="rgba(255, 255, 255, 0.25)",e.lineWidth=2,e.beginPath(),e.moveTo(s,L),e.lineTo(a-s,L),e.stroke(),e.save(),e.textAlign="center",e.fillStyle="rgba(255, 255, 255, 0.7)",e.font='16px "Inter", sans-serif';const i=Math.min(d-12,L+28),p=T(w.beachLengthM,{maximumFractionDigits:0});e.fillText(`Beach length = ${p} m`,a/2,i),e.restore()}function U(n){const i=a-s*2,u=(L-h)*.25,y=L-u;g.loadStates.forEach(f=>{const v=s+f.startPosM/g.beachLength*i,F=s+f.endPosM/g.beachLength*i,I=f.arrivalMin,b=f.cleanedAtMinute;if(b<=0||n>=b)return;let W=1;if(n>I){const C=Math.max(b-I,.01),x=Math.min(Math.max((n-I)/C,0),1);W=Math.max(0,1-x)}e.save(),e.globalAlpha=W;const O=e.createLinearGradient(v,y,F,L);O.addColorStop(0,"rgba(121, 85, 72, 0.92)"),O.addColorStop(.5,"rgba(93, 64, 55, 0.95)"),O.addColorStop(1,"rgba(121, 85, 72, 0.92)"),e.fillStyle=O,e.fillRect(v,y,F-v,u),e.restore()})}function B(n,i,p=1){if(!n.length)return{position:0,phase:"idle",loadId:null,direction:p,progress:0};const u=n[n.length-1].endMin;if(u===0)return{position:0,phase:"idle",loadId:null,direction:p,progress:0};let y=i%u,f=p;for(let I=0;I<n.length;I+=1){const b=n[I];if(y<b.startMin)return{position:b.startPosM,phase:"idle",loadId:b.loadId,direction:f,progress:0};if(y<=b.endMin||b.endMin===b.startMin){const W=b.endMin-b.startMin,O=W>0?(y-b.startMin)/W:1,C=b.startPosM+(b.endPosM-b.startPosM)*O,x=Math.sign(b.endPosM-b.startPosM);return x!==0&&(f=x),{position:C,phase:b.phase,loadId:b.loadId,direction:f,progress:O}}}const v=n[n.length-1],F=Math.sign(v.endPosM-v.startPosM);return F!==0&&(f=F),{position:v.endPosM,phase:"idle",loadId:v.loadId,direction:f,progress:0}}function Te(){e.strokeStyle="rgba(255, 255, 255, 0.12)",e.lineWidth=1,e.setLineDash([6,8]),g.loadMarkers.forEach(n=>{const i=s+n/g.beachLength*(a-s*2);e.beginPath(),e.moveTo(i,h),e.lineTo(i,L),e.stroke()}),e.setLineDash([])}function Ae(n,i,p,u=1,y=!1){e.save();const f=5,v=28,F=12,I=36,b=14,W=8,O=u>=0?1:-1,C=n-v/2,x=i-f-F,V=C+v,le=i-f-b+2;let _,G,te,de;if(O>=0?(G=C-W,_=G-I,te=C,de=G):(_=V+W,G=_+I,te=V,de=_),e.fillStyle=p,e.fillRect(C,x,v,F),e.fillStyle="rgba(255, 255, 255, 0.2)",e.fillRect(C+6,x+3,12,F-6),e.fillStyle=p,e.fillRect(_,le,I,b),y){const Q=b*.9,ye=I*.08,ue=_+ye,be=G-ye,ie=le+2,we=ie-Q;e.fillStyle="#8d6e63",e.beginPath(),e.moveTo(ue,ie),e.quadraticCurveTo((ue+be)/2,we,be,ie),e.lineTo(ue,ie),e.closePath(),e.fill()}e.strokeStyle="rgba(255, 255, 255, 0.4)",e.lineWidth=2,e.beginPath(),e.moveTo(te,i-f-2),e.lineTo(de,i-f+1),e.stroke();const he="rgba(15, 32, 52, 0.85)",ke=[{x:C+v*.25,y:i},{x:V-v*.25,y:i},{x:_+I*.2,y:i+1},{x:G-I*.2,y:i+1}];e.fillStyle=he,ke.forEach(Q=>{e.beginPath(),e.arc(Q.x,Q.y,f,0,Math.PI*2),e.fill(),e.fillStyle="rgba(255, 255, 255, 0.25)",e.beginPath(),e.arc(Q.x,Q.y,f*.4,0,Math.PI*2),e.fill(),e.fillStyle=he}),e.fillStyle="rgba(15, 32, 52, 0.85)";const fe=12,Pe=O>=0?V-fe+2:C-2;e.fillRect(Pe,x-6,fe,6),e.beginPath(),O>=0?(e.moveTo(V-v*.7,x),e.lineTo(V-v*.4,x-8),e.lineTo(V-v*.15,x-8),e.lineTo(V-v*.3,x)):(e.moveTo(C+v*.7,x),e.lineTo(C+v*.4,x-8),e.lineTo(C+v*.15,x-8),e.lineTo(C+v*.3,x)),e.closePath(),e.fill();const J=O>=0?V-v*.35:C+v*.35,ce=4,pe=x-ce-2,Ce=8,ge=6;e.fillStyle="#ffd180",e.beginPath(),e.arc(J,pe,ce,0,Math.PI*2),e.fill(),e.fillStyle="#0f2034",e.fillRect(J-ge/2,pe+ce-1,ge,Ce);const re=x+2,Me=10;e.strokeStyle="#cfd8dc",e.lineWidth=2,e.beginPath(),O>=0?(e.moveTo(J-2,re),e.lineTo(J-2-Me,re-2)):(e.moveTo(J+2,re),e.lineTo(J+2+Me,re-2)),e.stroke(),e.restore()}function xe(n){const i=[];g.segmentsByAtv.forEach((p,u)=>{const y=D[u]??1,{position:f,phase:v,loadId:F,direction:I,progress:b}=B(p,n,y);D[u]=I||y||1;const W=Se[u%Se.length],O=s+f/g.beachLength*(a-s*2),C=L-30-u*18,x=.001,V=v==="loading"&&b>=1-x||v==="return"||v==="hold"||v==="approach"||v==="transfer"&&b<1-x;Ae(O,C,W,D[u],V),e.fillStyle=W,e.font='12px "Inter", sans-serif',e.fillText(`ATV ${u+1}`,O-20,C+22);const _=(F?g.loadStates.find(te=>te.loadId===F):void 0)?.crew??"Crew",G=T(w.trailerCapacityM3,{minimumFractionDigits:1,maximumFractionDigits:1});i.push(`ATV ${u+1}: ${v} load ${F??"—"} (${_}, capacity ${G} m³)`)}),r.textContent=i.join("  •  ")}function ve(n){if(K()){P=null;return}k===null&&(k=n);const i=Math.max((n-k)/1e3,0);k=n;const p=Math.max(g.totalMinutes,1);S+=i*R,S>p&&(S=p);const u=S;if(ee(),U(u),Te(),xe(u),ae(u),j(u),$(u),S>=p){A=!0,P=null,N();return}P=requestAnimationFrame(ve)}return Z(),{update:ne,updateSpeed:se,toggleManualPause:H,isPaused:K,onStateChange:oe}}function $e(t,m,o){if(m.atvSpeedKmh<=0){t.textContent="Increase ATV speed above zero to animate the transport cycle.";return}if(o.trailersPerDay<=0||o.requiredAtvs<=0){t.textContent="Adjust inputs to produce a non-zero workload for ATVs.";return}t.textContent=""}function Ue(){const t={...me},m={...De},{canvas:o,derivedList:l,status:r,timeLabel:e,loadedLabel:a,idleLabel:d,toggleButton:s,detailsLabel:g,derivedSection:w,derivedToggle:R,atvOverrideToggle:D,atvOverrideInput:E,atvOverrideHint:A}=He(),S=Be(o,e,a,d,g);let k=!1;function P(){const M=Fe(t),c=m.atvOverrideEnabled?m.atvOverrideCount:null,h=qe(t,M,{overrideAtvCount:c}),L={totalMinutes:h.totalMinutes,integerAtvs:h.numAtvs,overrideAtvs:h.overrideAtvCount!=null,computedIntegerAtvs:M.integerAtvs};if(Ve(l,M,L),$e(r,t,M),S.update(h,t),A){const N=T(M.integerAtvs,{maximumFractionDigits:0});if(h.overrideAtvCount!=null){const q=T(h.overrideAtvCount,{maximumFractionDigits:0});A.textContent=`Manual override active (${q} ATVs, computed ${N}).`}else A.textContent=`Using computed requirement (${N} ATVs).`}if(D&&(D.dataset.computedAtvs=String(M.integerAtvs)),E){const N=T(M.integerAtvs,{maximumFractionDigits:0});(!m.atvOverrideEnabled||m.atvOverrideCount==null)&&(E.placeholder=`Computed ${N}`)}}if(Ne(t,(M,c)=>{t[M]=c,P()}),Re(m,M=>{S.updateSpeed(M)}),s){const M=({paused:c})=>{s.textContent=c?"Run":"Pause"};S.onStateChange(M),s.addEventListener("click",()=>{const c=S.isPaused();S.toggleManualPause(!c)})}We(m,P,{toggle:D,input:E}),R.addEventListener("click",()=>{k=!k,w.classList.toggle("collapsed",k),R.textContent=k?"Show metrics":"Hide metrics"}),P()}Ue();
