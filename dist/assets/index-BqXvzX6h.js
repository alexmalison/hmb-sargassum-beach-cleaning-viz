(function(){const f=document.createElement("link").relList;if(f&&f.supports&&f.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))e(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&e(n)}).observe(document,{childList:!0,subtree:!0});function a(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function e(r){if(r.ep)return;r.ep=!0;const i=a(r);fetch(r.href,i)}})();const Ee=52/12,Le=1,Se=["#64ffda","#90caf9","#ffd54f","#ff8a80","#ce93d8","#80cbc4"],me={seasonLengthMonths:5,sargassumVolumeM3:7183.15,workDaysPerWeek:6,workHoursPerDay:5,trailerCapacityM3:2,timePerWorkerLoadM3Minutes:25,atvSpeedKmh:3,beachLengthM:600,loadTransferTimeMinutes:11,loadingMode:"single"},Ie={minutesPerSecond:Le,atvOverrideCount:0},Fe=[{key:"seasonLengthMonths",label:"Length of season (months)",min:1,max:12,step:.1,section:"season"},{key:"sargassumVolumeM3",label:"Estimated Sargassum volume (m³)",min:0,max:2e4,step:10,section:"season"},{key:"workDaysPerWeek",label:"Working days per week",min:1,max:7,step:1,section:"season"},{key:"workHoursPerDay",label:"Working hours per day",min:1,max:24,step:.5,section:"season"},{key:"trailerCapacityM3",label:"Trailer capacity (m³)",min:.1,max:5,step:.1,section:"labor"},{key:"timePerWorkerLoadM3Minutes",label:"Time to load 1 m³ per worker (minutes)",min:1,max:60,step:1,section:"labor"},{key:"atvSpeedKmh",label:"ATV speed (km/h)",min:0,max:15,step:.1,section:"atv"},{key:"beachLengthM",label:"Beach length (m)",min:60,max:1500,step:10,section:"atv"},{key:"loadTransferTimeMinutes",label:"Load transfer wait (minutes)",min:0,max:60,step:1,section:"atv"},{key:"loadingMode",label:"Loading mode",type:"select",options:[{value:"single",label:"Whole crew from west"},{value:"split",label:"Split crews west/east"}],section:"labor"}],He=[{key:"avgDailyRemoval",label:"Average daily removal (m³)",format:t=>k(t,{maximumFractionDigits:2})},{key:"avgHourlyRemoval",label:"Average hourly removal (m³)",format:t=>k(t,{maximumFractionDigits:2})},{key:"trailersPerDay",label:"Trailer loads per day",format:t=>k(t,{maximumFractionDigits:2})},{key:"timeWorkerLoadHours",label:"Worker hours to load trailers (per day)",format:t=>k(t,{maximumFractionDigits:2})},{key:"requiredBeachWorkers",label:"Beach workers required (load crew)",format:t=>k(t,{maximumFractionDigits:2})},{key:"timeToLoadTrailerMinutes",label:"Time to load trailer (minutes)",format:t=>k(t,{maximumFractionDigits:2})},{key:"timeToLoadingAreaMinutes",label:"Travel to loading area (minutes)",format:t=>k(t,{maximumFractionDigits:2})},{key:"totalAtvTimePerLoadMinutes",label:"ATV cycle time per load (minutes)",format:t=>k(t,{maximumFractionDigits:2})},{key:"timePerAtvHours",label:"ATV duty time (hours/day)",format:t=>k(t,{maximumFractionDigits:2})},{key:"requiredAtvs",label:"Required # of ATVs",format:t=>k(t,{maximumFractionDigits:2})},{key:"requiredAtvDrivers",label:"Required # of ATV drivers",format:t=>k(t,{maximumFractionDigits:2})},{key:"requiredUnloadWorkers",label:"Required # of unload workers",format:t=>k(t,{maximumFractionDigits:2})},{key:"integerLoads",label:"Loads simulated today",format:t=>k(t,{maximumFractionDigits:0})},{key:"integerAtvs",label:"ATVs in rotation",format:t=>k(t,{maximumFractionDigits:0})},{key:"totalMinutes",label:"Day cycle duration (minutes)",format:t=>k(t,{maximumFractionDigits:1}),note:"Full rotation for busiest ATV within the day"}];function k(t,f={}){return Number.isFinite(t)?new Intl.NumberFormat("en-US",{maximumFractionDigits:2,minimumFractionDigits:0,...f}).format(t):"—"}function qe(t){const f=t.seasonLengthMonths*Ee,a=f*t.workDaysPerWeek,e=a>0?t.sargassumVolumeM3/a:0,r=t.workHoursPerDay>0?e/t.workHoursPerDay:0,i=t.trailerCapacityM3>0?e/t.trailerCapacityM3:0,c=t.timePerWorkerLoadM3Minutes*e/60,h=t.workHoursPerDay>0?c/t.workHoursPerDay:0,P=h>0?t.trailerCapacityM3*t.timePerWorkerLoadM3Minutes/h:0,E=t.atvSpeedKmh*1e3/60,x=t.beachLengthM/2,S=E>0?x/E:0,C=S,L=S+P+C,M=L*i/60,T=t.workHoursPerDay>0?M/t.workHoursPerDay:0,I=T,H=t.workHoursPerDay>0?i*P/60/t.workHoursPerDay:0,p=Math.max(1,Math.round(i)),g=Math.max(1,Math.ceil(T));return{workingWeeks:f,workingDaysSeason:a,avgDailyRemoval:e,avgHourlyRemoval:r,trailersPerDay:i,timeWorkerLoadHours:c,requiredBeachWorkers:h,timeToLoadTrailerMinutes:P,timeToLoadingAreaMinutes:S,totalAtvTimePerLoadMinutes:L,timePerAtvHours:M,requiredAtvs:T,requiredAtvDrivers:I,requiredUnloadWorkers:H,integerLoads:p,integerAtvs:g}}function Ne(t,f,a={}){const e=f.integerLoads,r=Number(a.overrideAtvCount),i=Number.isFinite(r)&&r>0?Math.max(1,Math.round(r)):null,n=i??f.integerAtvs,c=[],h=[],P=Array.from({length:n},()=>[]),E=Array.from({length:n},()=>0),x=Math.max(0,t.loadTransferTimeMinutes??0);if(e<=0||n<=0)return{loadMarkers:c,segmentsByAtv:P,totalMinutes:0,numLoads:0,numAtvs:n,loadStates:h};const S=t.beachLengthM/e,C=f.timeToLoadTrailerMinutes,L=t.atvSpeedKmh>0?t.atvSpeedKmh*1e3/60:0;let M=0,T=0;const I=Array.from({length:e},(p,g)=>{const W=g*S,D=(g+1)*S,N=W+S/2;return{loadIndex:g+1,startPosM:W,endPosM:D,centerPosM:N}});c.push(...I.map(p=>p.centerPosM).sort((p,g)=>p-g));let H;if((t.loadingMode??"single")==="split"){H=[];let p=0,g=e-1,W=!0;for(;p<=g;)W?(H.push({...I[p],crew:"West crew"}),p+=1):(H.push({...I[g],crew:"East crew"}),g-=1),W=!W;H.length&&e%2===1&&(H[H.length-1].crew="Both crews")}else H=I.map(p=>({...p,crew:"Main crew"}));return H.forEach(p=>{const g=p.centerPosM,W=p.startPosM,D=p.endPosM,N=Math.min(g,5),se=L>0?g/L:0,z=L>0?Math.max(g-N,0)/L:0,le=L>0?N/L:0;let R=0,oe=E[0];for(let B=1;B<n;B+=1)E[B]<oe-Number.EPSILON&&(oe=E[B],R=B);const _=E[R],J=_+se,K=J+C,X=K+z,ae=X+le;let j=0,$=ae;$<M&&(j=M-$,$=M);const Q=$+x,G=B=>{P[R].push(B),T=Math.max(T,B.endMin)};G({atvId:R,loadId:p.loadIndex,phase:"outbound",startMin:_,endMin:J,startPosM:0,endPosM:g}),G({atvId:R,loadId:p.loadIndex,phase:"loading",startMin:J,endMin:K,startPosM:g,endPosM:g}),z>0?G({atvId:R,loadId:p.loadIndex,phase:"return",startMin:K,endMin:X,startPosM:g,endPosM:N}):G({atvId:R,loadId:p.loadIndex,phase:"return",startMin:K,endMin:K,startPosM:g,endPosM:N}),j>0&&G({atvId:R,loadId:p.loadIndex,phase:"hold",startMin:X,endMin:X+j,startPosM:N,endPosM:N}),G({atvId:R,loadId:p.loadIndex,phase:"approach",startMin:X+j,endMin:$,startPosM:N,endPosM:0}),G({atvId:R,loadId:p.loadIndex,phase:"transfer",startMin:$,endMin:Q,startPosM:0,endPosM:0}),E[R]=Q,M=Q,h.push({startPosM:W,endPosM:D,arrivalMin:J,cleanedAtMinute:K,crew:p.crew,loadId:p.loadIndex})}),{loadMarkers:c,segmentsByAtv:P.map(p=>p.sort((g,W)=>g.startMin-W.startMin)),totalMinutes:T,numLoads:e,numAtvs:n,loadStates:h,overrideAtvCount:i}}function Re(){const t=document.querySelector("#app");return t.innerHTML=`
    <section class="controls">
      <div class="control-header">
        <h1>HMB Beach Cleanup Model</h1>
        <p>Set the season-scale inputs from the spreadsheet; the animation shows how one workday plays out with those assumptions.</p>
      </div>
      <div class="controls-groups">
        <div class="control-group">
          <h2>Season Parameters</h2>
          <div class="input-grid" data-section="season"></div>
        </div>
        <div class="control-group">
          <h2>Trailer &amp; Labor</h2>
          <div class="input-grid" data-section="labor"></div>
        </div>
        <div class="control-group">
          <h2>ATV Operations</h2>
          <div class="input-grid" data-section="atv"></div>
          <div class="field override-field">
            <label for="atvOverrideInput">Override # of ATVs</label>
            <input
              type="number"
              id="atvOverrideInput"
              min="0"
              step="1"
              placeholder="0 for auto"
            />
            <span class="field-note" id="atvOverrideHint"></span>
          </div>
        </div>
      </div>
      <div class="derived-section" id="derivedSection">
        <div class="derived-header">
          <h2>Derived Metrics</h2>
          <button type="button" class="toggle-derived" id="toggleDerived">Hide metrics</button>
        </div>
        <ul class="metrics-list" id="derivedMetrics"></ul>
      </div>
      <div class="status" id="status"></div>
    </section>
    <section class="simulation">
      <div class="canvas-container">
        <canvas id="beachCanvas" width="720" height="420"></canvas>
        <div class="canvas-overlay canvas-overlay-top">
          <div class="sim-controls">
            <button type="button" id="toggleRun" class="toggle-run">Pause</button>
            <span id="timeLabel" class="sim-stat">Sim time 00:00:00</span>
            <div class="speed-slider">
              <input type="range" id="speedSlider" min="1" max="60" step="1" />
              <span id="speedValue">1 s → 1 min</span>
            </div>
          </div>
        </div>
        <div class="canvas-overlay canvas-overlay-bottom">
          <span id="detailsLabel"></span>
        </div>
      </div>
    </section>
  `,{canvas:document.querySelector("#beachCanvas"),derivedList:document.querySelector("#derivedMetrics"),status:document.querySelector("#status"),timeLabel:document.querySelector("#timeLabel"),toggleButton:document.querySelector("#toggleRun"),detailsLabel:document.querySelector("#detailsLabel"),derivedSection:document.querySelector("#derivedSection"),derivedToggle:document.querySelector("#toggleDerived"),speedSlider:document.querySelector("#speedSlider"),speedValue:document.querySelector("#speedValue"),atvOverrideInput:document.querySelector("#atvOverrideInput"),atvOverrideHint:document.querySelector("#atvOverrideHint")}}function Oe(t,f){Fe.forEach(a=>{const e=document.querySelector(`[data-section="${a.section}"]`);if(!e)return;const r=document.createElement("div");r.className="field";const i=document.createElement("label");i.textContent=a.label;let n;if(a.type==="select"&&Array.isArray(a.options))n=document.createElement("select"),a.options.forEach(c=>{const h=document.createElement("option");h.value=String(c.value),h.textContent=c.label,n.append(h)}),n.value=String(t[a.key]),n.addEventListener("change",()=>{const c=n.value,h=Number(c),E=a.options.every(x=>typeof x.value=="number")&&Number.isFinite(h)?h:c;f(a.key,E)});else{n=document.createElement("input");const c=a.type==="text"?"text":"number";if(n.type=c,a.key==="trailerCapacityM3"?n.value=Number(t[a.key]??0).toFixed(1):n.value=String(t[a.key]??""),a.placeholder&&(n.placeholder=a.placeholder),c==="number"){a.min!==void 0&&(n.min=String(a.min)),a.max!==void 0&&(n.max=String(a.max)),a.step!==void 0&&(n.step=String(a.step));const h=()=>{const P=Number(n.value);Number.isFinite(P)&&(f(a.key,P),a.key==="trailerCapacityM3"&&(n.value=P.toFixed(1)))};a.key==="trailerCapacityM3"?(n.addEventListener("change",h),n.addEventListener("blur",h)):n.addEventListener("input",h)}else n.addEventListener("input",()=>{f(a.key,n.value)})}r.append(i,n),e.append(r)})}function We(t,f){const a=document.querySelector("#speedSlider"),e=document.querySelector("#speedValue");if(!a||!e)return;const r=i=>{const n=Math.max(1,Math.round(i));e.textContent=`1 s → ${n} min`,f(i)};a.value=String(t.minutesPerSecond),r(t.minutesPerSecond),a.addEventListener("input",()=>{const i=Number(a.value);!Number.isFinite(i)||i<=0||(t.minutesPerSecond=i,r(i))})}function Ve(t,f,a={}){const e=a.input??document.querySelector("#atvOverrideInput");if(!e)return;const r=i=>{const n=Number(i);!Number.isFinite(n)||n<=0?(t.atvOverrideCount=0,e.value="0"):(t.atvOverrideCount=Math.round(n),e.value=String(t.atvOverrideCount)),f()};e.value=t.atvOverrideCount>0?String(t.atvOverrideCount):"0",e.addEventListener("change",()=>{r(e.value)}),e.addEventListener("blur",()=>{r(e.value)}),e.addEventListener("keydown",i=>{i.key==="Enter"&&(i.preventDefault(),r(e.value))})}function Be(t,f,a){t.innerHTML="",He.forEach(e=>{let r;e.key==="totalMinutes"?r=a.totalMinutes:e.key==="integerAtvs"?r=a.integerAtvs??f.integerAtvs:r=f[e.key];const i=document.createElement("li");i.className="metric-card";const n=document.createElement("span");n.className="label",n.textContent=e.label;const c=document.createElement("span");if(c.className="value",c.textContent=e.format?e.format(r):String(r),i.append(n,c),e.key==="integerAtvs"&&a.overrideAtvs){const h=document.createElement("span");h.className="note";const P=k(a.computedIntegerAtvs,{maximumFractionDigits:0});h.textContent=`Manual override active (computed ${P})`,i.append(h)}else if(e.note){const h=document.createElement("span");h.className="note",h.textContent=e.note,i.append(h)}t.append(i)})}function $e(t,f,a){const e=t.getContext("2d"),r=t.width,i=t.height,n=70;let c={loadMarkers:[],loadStates:[],segmentsByAtv:[],totalMinutes:1,numAtvs:0,beachLength:me.beachLengthM},h={...me},P=Le,E=[],x=!1,S=!1,C=0,L=null,M=null,T=[];const I=new Set;let H="Loaded 0.0 m³",p="Crew idle time 00:00:00";const g=i*.3,W=i*.4,D=g+W;function N(){const o={paused:_(),manuallyPaused:x,autoPaused:S};I.forEach(s=>{try{s(o)}catch{}})}function se(){M!==null&&(cancelAnimationFrame(M),M=null)}function z(){M===null&&!_()&&(M=requestAnimationFrame(ve))}function le(o,s){c={...o,beachLength:s.beachLengthM},h={...s},E=new Array(c.numAtvs).fill(1),C=0,L=null,S=!1,T=K(c.loadStates??[]),j(C),$(C),Q(C),N(),z()}function R(o){P=o,L=null}function oe(o){const s=x;return typeof o=="boolean"?x=o:x=!x,x?s||se():(S&&(S=!1,C=0),L=null,z()),N(),x}function _(){return x||S}function J(o){return typeof o!="function"?()=>{}:(I.add(o),o({paused:_(),manuallyPaused:x,autoPaused:S}),()=>{I.delete(o)})}function K(o){const s=o.map(l=>{const v=Math.min(l.arrivalMin,l.cleanedAtMinute),m=Math.max(l.arrivalMin,l.cleanedAtMinute);return m>v?{start:v,end:m}:null}).filter(Boolean).sort((l,v)=>l.start-v.start);if(!s.length)return[];const u=[s[0]];for(let l=1;l<s.length;l+=1){const v=s[l],m=u[u.length-1];v.start<=m.end?m.end=Math.max(m.end,v.end):u.push({...v})}return u}function X(o){if(!T.length||o<=T[0].start)return 0;let s=0;for(let u=0;u<T.length;u+=1){const{start:l,end:v}=T[u];if(o<=l)break;const m=Math.min(v,o);if(s+=Math.max(0,m-l),o<=v)break}return Math.min(s,Math.max(0,o))}function ae(o){const s=Math.max(0,Math.floor(o*60)),u=Math.floor(s/3600),l=Math.floor(s%3600/60),v=s%60;return`${String(u).padStart(2,"0")}:${String(l).padStart(2,"0")}:${String(v).padStart(2,"0")}`}function j(o){f&&(f.textContent=`Sim time ${ae(o)}`)}function $(o){const s=Number(h.trailerCapacityM3)||0;if(s<=0||!Array.isArray(c.loadStates)){H="Loaded 0.0 m³";return}let u=0;c.loadStates.forEach(v=>{const m=v.arrivalMin,d=v.cleanedAtMinute;if(!(!Number.isFinite(m)||!Number.isFinite(d)||d<=m)){if(o>=d)u+=s;else if(o>m){const w=Math.max(0,Math.min((o-m)/(d-m),1));u+=s*w}}}),H=`Loaded ${k(u,{minimumFractionDigits:1,maximumFractionDigits:1})} m³`}function Q(o){const s=X(o),u=Math.max(0,o-s);p=`Crew idle time ${ae(u)}`}function G(){e.fillStyle="#0f2034",e.fillRect(0,0,r,i);const o=e.createLinearGradient(0,0,0,g);o.addColorStop(0,"rgba(236, 221, 180, 0.92)"),o.addColorStop(.6,"rgba(226, 205, 156, 0.9)"),o.addColorStop(1,"rgba(212, 186, 134, 0.88)"),e.fillStyle=o,e.fillRect(0,0,r,g);const s=e.createLinearGradient(0,D,0,i);s.addColorStop(0,"rgba(118, 213, 237, 0.85)"),s.addColorStop(1,"rgba(64, 191, 255, 0.9)"),e.fillStyle=s,e.fillRect(0,D,r,i-D);const u=e.createLinearGradient(0,g,0,D);u.addColorStop(0,"rgba(214, 196, 148, 0.82)"),u.addColorStop(1,"rgba(198, 174, 122, 0.78)"),e.fillStyle=u,e.fillRect(0,g,r,D-g),e.strokeStyle="rgba(255, 255, 255, 0.25)",e.lineWidth=2,e.beginPath(),e.moveTo(n,D),e.lineTo(r-n,D),e.stroke(),e.save(),e.textAlign="center",e.fillStyle="rgba(255, 255, 255, 0.7)",e.font='16px "Inter", sans-serif';const l=Math.min(i-12,D+28),m=[`Beach length = ${k(h.beachLengthM,{maximumFractionDigits:0})} m`,H,p];e.fillText(m.join("   •   "),r/2,l),e.restore()}function B(o){const s=r-n*2,l=(D-g)*.25,v=D-l;e.save();const m=e.createLinearGradient(0,v,0,v+l);m.addColorStop(0,"rgba(214, 196, 148, 0.84)"),m.addColorStop(1,"rgba(198, 174, 122, 0.82)"),e.fillStyle=m,e.fillRect(n,v,r-n*2,l),e.restore(),c.loadStates.forEach(d=>{const w=n+d.startPosM/c.beachLength*s,F=n+d.endPosM/c.beachLength*s,y=d.arrivalMin,V=d.cleanedAtMinute;if(V<=0)return;const q=e.createLinearGradient(w,v,F,D);if(q.addColorStop(0,"rgba(214, 196, 148, 0.82)"),q.addColorStop(.6,"rgba(200, 178, 130, 0.8)"),q.addColorStop(1,"rgba(186, 162, 112, 0.78)"),e.save(),e.fillStyle=q,e.fillRect(w,v,F-w,l),e.restore(),o>=V)return;let A=1;if(o>y){const O=Math.max(V-y,.01),te=Math.min(Math.max((o-y)/O,0),1);A=Math.max(0,1-te)}if(A<=0)return;e.save(),e.globalAlpha=A;const b=e.createLinearGradient(w,v,F,D);b.addColorStop(0,"rgba(121, 85, 72, 0.92)"),b.addColorStop(.5,"rgba(93, 64, 55, 0.95)"),b.addColorStop(1,"rgba(121, 85, 72, 0.92)"),e.fillStyle=b,e.fillRect(w,v,F-w,l),e.restore()})}function Te(o,s,u=1){if(!o.length)return{position:0,phase:"idle",loadId:null,direction:u,progress:0};const l=o[o.length-1].endMin;if(l===0)return{position:0,phase:"idle",loadId:null,direction:u,progress:0};let v=s%l,m=u;for(let F=0;F<o.length;F+=1){const y=o[F];if(v<y.startMin)return{position:y.startPosM,phase:"idle",loadId:y.loadId,direction:m,progress:0};if(v<=y.endMin||y.endMin===y.startMin){const V=y.endMin-y.startMin,q=V>0?(v-y.startMin)/V:1,A=y.startPosM+(y.endPosM-y.startPosM)*q,b=Math.sign(y.endPosM-y.startPosM);return b!==0&&(m=b),{position:A,phase:y.phase,loadId:y.loadId,direction:m,progress:q}}}const d=o[o.length-1],w=Math.sign(d.endPosM-d.startPosM);return w!==0&&(m=w),{position:d.endPosM,phase:"idle",loadId:d.loadId,direction:m,progress:0}}function Ae(){e.strokeStyle="rgba(255, 255, 255, 0.12)",e.lineWidth=1,e.setLineDash([6,8]),c.loadMarkers.forEach(o=>{const s=n+o/c.beachLength*(r-n*2);e.beginPath(),e.moveTo(s,g),e.lineTo(s,D),e.stroke()}),e.setLineDash([])}function ke(o,s,u,l=1,v=!1){e.save();const m=5,d=28,w=12,F=36,y=14,V=8,q=l>=0?1:-1,A=o-d/2,b=s-m-w,O=A+d,te=s-m-y+2;let U,Y,ne,de;if(q>=0?(Y=A-V,U=Y-F,ne=A,de=Y):(U=O+V,Y=U+F,ne=O,de=U),e.fillStyle=u,e.fillRect(A,b,d,w),e.fillStyle="rgba(255, 255, 255, 0.2)",e.fillRect(A+6,b+3,12,w-6),e.fillStyle=u,e.fillRect(U,te,F,y),v){const ee=y*.9,ye=F*.08,ue=U+ye,be=Y-ye,ie=te+2,De=ie-ee;e.fillStyle="#8d6e63",e.beginPath(),e.moveTo(ue,ie),e.quadraticCurveTo((ue+be)/2,De,be,ie),e.lineTo(ue,ie),e.closePath(),e.fill()}e.strokeStyle="rgba(255, 255, 255, 0.4)",e.lineWidth=2,e.beginPath(),e.moveTo(ne,s-m-2),e.lineTo(de,s-m+1),e.stroke();const fe="rgba(15, 32, 52, 0.85)",xe=[{x:A+d*.25,y:s},{x:O-d*.25,y:s},{x:U+F*.2,y:s+1},{x:Y-F*.2,y:s+1}];e.fillStyle=fe,xe.forEach(ee=>{e.beginPath(),e.arc(ee.x,ee.y,m,0,Math.PI*2),e.fill(),e.fillStyle="rgba(255, 255, 255, 0.25)",e.beginPath(),e.arc(ee.x,ee.y,m*.4,0,Math.PI*2),e.fill(),e.fillStyle=fe}),e.fillStyle="rgba(15, 32, 52, 0.85)";const he=12,Ce=q>=0?O-he+2:A-2;e.fillRect(Ce,b-6,he,6),e.beginPath(),q>=0?(e.moveTo(O-d*.7,b),e.lineTo(O-d*.4,b-8),e.lineTo(O-d*.15,b-8),e.lineTo(O-d*.3,b)):(e.moveTo(A+d*.7,b),e.lineTo(A+d*.4,b-8),e.lineTo(A+d*.15,b-8),e.lineTo(A+d*.3,b)),e.closePath(),e.fill();const Z=q>=0?O-d*.35:A+d*.35,ce=4,pe=b-ce-2,we=8,ge=6;e.fillStyle="#ffd180",e.beginPath(),e.arc(Z,pe,ce,0,Math.PI*2),e.fill(),e.fillStyle="#0f2034",e.fillRect(Z-ge/2,pe+ce-1,ge,we);const re=b+2,Me=10;e.strokeStyle="#cfd8dc",e.lineWidth=2,e.beginPath(),q>=0?(e.moveTo(Z-2,re),e.lineTo(Z-2-Me,re-2)):(e.moveTo(Z+2,re),e.lineTo(Z+2+Me,re-2)),e.stroke(),e.restore()}function Pe(o){const s=[];c.segmentsByAtv.forEach((u,l)=>{const v=E[l]??1,{position:m,phase:d,loadId:w,direction:F,progress:y}=Te(u,o,v);E[l]=F||v||1;const V=Se[l%Se.length],q=n+m/c.beachLength*(r-n*2),A=D-30-l*18,b=.001,O=d==="loading"&&y>=1-b||d==="return"||d==="hold"||d==="approach"||d==="transfer"&&y<1-b;ke(q,A,V,E[l],O),e.fillStyle=V,e.font='12px "Inter", sans-serif',e.fillText(`ATV ${l+1}`,q-20,A+22);const U=(w?c.loadStates.find(ne=>ne.loadId===w):void 0)?.crew??"Crew",Y=k(h.trailerCapacityM3,{minimumFractionDigits:1,maximumFractionDigits:1});s.push(`ATV ${l+1}: ${d} load ${w??"—"} (${U}, capacity ${Y} m³)`)}),a.textContent=s.join("  •  ")}function ve(o){if(_()){M=null;return}L===null&&(L=o);const s=Math.max((o-L)/1e3,0);L=o;const u=Math.max(c.totalMinutes,1);C+=s*P,C>u&&(C=u);const l=C;if(G(),B(l),Ae(),Pe(l),j(l),$(l),Q(l),C>=u){S=!0,M=null,N();return}M=requestAnimationFrame(ve)}return z(),{update:le,updateSpeed:R,toggleManualPause:oe,isPaused:_,onStateChange:J}}function Ge(t,f,a){if(f.atvSpeedKmh<=0){t.textContent="Increase ATV speed above zero to animate the transport cycle.";return}if(a.trailersPerDay<=0||a.requiredAtvs<=0){t.textContent="Adjust inputs to produce a non-zero workload for ATVs.";return}t.textContent=""}function Ue(){const t={...me},f={...Ie},{canvas:a,derivedList:e,status:r,timeLabel:i,toggleButton:n,detailsLabel:c,derivedSection:h,derivedToggle:P,atvOverrideInput:E,atvOverrideHint:x}=Re(),S=$e(a,i,c);let C=!1;function L(){const M=qe(t),T=f.atvOverrideCount>0?f.atvOverrideCount:null,I=Ne(t,M,{overrideAtvCount:T}),H={totalMinutes:I.totalMinutes,integerAtvs:I.numAtvs,overrideAtvs:I.overrideAtvCount!=null,computedIntegerAtvs:M.integerAtvs};if(Be(e,M,H),Ge(r,t,M),S.update(I,t),x){const p=k(M.integerAtvs,{maximumFractionDigits:0});if(I.overrideAtvCount!=null){const g=k(I.overrideAtvCount,{maximumFractionDigits:0});x.textContent=`Manual override active (${g} ATVs, computed ${p}).`}else x.textContent=`Using computed requirement (${p} ATVs).`}}if(Oe(t,(M,T)=>{t[M]=T,L()}),We(f,M=>{S.updateSpeed(M)}),n){const M=({paused:T})=>{n.textContent=T?"Run":"Pause"};S.onStateChange(M),n.addEventListener("click",()=>{const T=S.isPaused();S.toggleManualPause(!T)})}Ve(f,L,{input:E}),P.addEventListener("click",()=>{C=!C,h.classList.toggle("collapsed",C),P.textContent=C?"Show metrics":"Hide metrics"}),L()}Ue();
